SCANIMAGE = ../frontend/scanimage
TESTFILE  = testfile.pnm
DEVICE    = pnm:0
OPTIONS   = --filename=$(TESTFILE)

all: Makefile
	@echo "Use 'make test' to run the tests."

test: Makefile test.local

test.local: 
	@echo "Testing $(SCANIMAGE) with device $(DEVICE)"
	@if echo "Trying flatbed scanner" && \
	  $(SCANIMAGE) -d $(DEVICE) $(OPTIONS) -T && \
	  echo "Trying three pass flatbed scanner" && \
	  $(SCANIMAGE) -d $(DEVICE) $(OPTIONS) --three-pass=yes   -T && \
	  echo "Trying hand scanner" && \
	  $(SCANIMAGE) -d $(DEVICE) $(OPTIONS) --hand-scanner=yes -T ; \
	then echo ; echo ; echo "All tests passed" ; \
	else echo ; echo; \
	echo "Something failed (maybe pnm backend not enabled by configure?)";\
	fi

# Generate new Makefile when something changes
Makefile: Makefile.in ../config.status
	cd .. \
	  && CONFIG_FILES=testsuite/Makefile CONFIG_HEADERS= /bin/sh ./config.status
